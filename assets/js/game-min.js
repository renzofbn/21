const gameCore=(()=>{'use strict';let deck=[];const cardTypes=['C','D','H','S'],specialTypes=['A','J','Q','K'];let playersPoints=[];const btnGetCard=document.querySelector('#btnGetCard'),btnStop=document.querySelector('#btnStop'),btnNewGame=document.querySelector('#btnNewGame');const divPlayersCards=document.querySelectorAll('.divCartas'),divPlayersPoints=document.querySelectorAll('small');function startGame(){deck=newDeck();cleanScore();btnGetCard.disabled=false;btnStop.disabled=false;btnNewGame.disabled=true;firstDealing()}function newDeck(){deck=[];for(let i=2;i<=10;i+=1){for(let type of cardTypes){deck.push(i+type)}}for(let type of cardTypes){for(let spcl of specialTypes){deck.push(spcl+type)}}return _.shuffle(deck)}function cleanScore(numPlayers=2){playersPoints=[];for(let i=0;i<numPlayers;i+=1){playersPoints.push({points:0,aceCount:0})}divPlayersPoints.forEach(elem=>elem.innerText=0);divPlayersCards.forEach(elem=>elem.innerHTML='')}function firstDealing(){const card1=takeCard();let player0Points=savePoints(0,card1);displayCard(0,card1);const card2=takeCard();player0Points=savePoints(0,card2);displayCard(0,card2);const card3=takeCard();savePoints(1,card3);displayCard(1,card3);displayCard(1);if(gratterThan20(player0Points)===true){dealerTurn(player0Points)}}function takeCard(){if(deck.length===0){throw 'There is no cards in deck, somenthing went wrong'}return deck.pop()}function getCardValue(card){const value=card.substring(0,card.length-1);return(isNaN(value))?(value==='A')?11:10:value*1}function savePoints(player,card){const cardValue=getCardValue(card);if(cardValue===11){playersPoints[player]['aceCount']+=1}playersPoints[player]['points']+=cardValue;if(playersPoints[player]['points']>21&&playersPoints[player]['aceCount']>0){playersPoints[player]['points']-=10;playersPoints[player]['aceCount']-=1}divPlayersPoints[player].innerText=playersPoints[player]['points'];return playersPoints[player]['points']}function displayCard(player,card='grey_back'){const cardImg=document.createElement('img');cardImg.src=`assets/cards/${ card }-min.png`;cardImg.classList.add('pockerCard');divPlayersCards[player].append(cardImg)}function dealerTurn(player0Points){let dealerPoints=0;divPlayersCards[1].removeChild(divPlayersCards[1].children[1]);do{const card=takeCard();dealerPoints=savePoints(1,card);displayCard(1,card)}while((dealerPoints<player0Points)&&(player0Points<=21));findWinner()}function findWinner(){const dealerPoints=playersPoints[1]['points'],player0Points=playersPoints[0]['points'];setTimeout(()=>{if(dealerPoints===player0Points){alert('Nadie gana :(')}else if(player0Points>21){alert('Dealer gana')}else if(dealerPoints>21){alert('Jugador Gana')}else{alert('Computadora Gana')}},1000);btnNewGame.disabled=false}function gratterThan20(points){if(points>=21){btnGetCard.disabled=true;btnStop.disabled=true;return true}return false}btnGetCard.addEventListener('click',()=>{const card=takeCard();const player0Points=savePoints(0,card);displayCard(0,card);if(gratterThan20(player0Points)){dealerTurn(player0Points)}});btnStop.addEventListener('click',()=>{btnGetCard.disabled=true;btnStop.disabled=true;dealerTurn(playersPoints[0]['points'])});return{newGame:startGame}})();